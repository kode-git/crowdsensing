<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>
    <script src="../dist/leaflet-heat.js"></script>
    <style type="text/css">
        /* TODO: Set the dimension for the map in according to the dashboards labels and fields */
    #map-wrapper {
    width: 100%;
    height: 500px;
    position: relative;
    border: 1px solid black;
    }

    #map {
    width: 100%;
    height: 100%;
    }

    #button-wrapper {
    position: absolute;
    bottom: -47px;
    width: 100%;
    margin-left: 10px;
    }
     
    </style>
    
</head>
<body>


<div class="span9" style="height:100%">
    <div id="map-wrapper">
        <div id="map"></div>
        <div id="button-wrapper">
            <button class="btn btn-primary" type="submit" id="marker">Show Noise Markers</button>
            <button class="btn btn-primary" type="submit" id="heatmap">Show Noise Heatmap</button>
        </div> 
    </div>
  </div>

<script type="text/javascript">

    //Get current position
    var options = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0
    };


    // TODO: Set the map informations in according to the displayed data
    // View coordinates of London (dummy one, need to be a variable in according to the dashboard infos
    var map = L.map('map').fitWorld();

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 10,
        tileSize: 512,
        zoomOffset: -1
    }).addTo(map);

    map.locate({setView: true, maxZoom: 16});
   
    function onLocationFound(e) {
    }

    map.on('locationfound', onLocationFound);

    $("#marker").on("click", e=>{
        e.preventDefault();
        $.ajax({
            url: "/getLocations",
            type: "POST",
            dataType: "json",
            
            success: function(data){
                console.log(data);
                for(i=0;i<data.length;i++){
                    L.marker([data[i].point.x, data[i].point.y]).addTo(map)
                .bindPopup('Noise: ' + data[i].noise + ' <br>Location: '+ data[i].point.x+ ', '+data[i].point.y)
                .openPopup();
                }
                
                }
        });
    });


    $("#heatmap").on("click", e=>{
        e.preventDefault();
        $.ajax({
            url: "/getLocations",
            type: "POST",
            dataType: "json",
            
            success: function(data){
                console.log("FUNZIONA");
                var heat = L.heatLayer([
                [50.5, 30.5, 0.2], // lat, lng, intensity
                [50.6, 30.4, 0.5]], {radius: 25}).addTo(map);
                }
        });
    });

    
       
   
</script>
</body>
</html>